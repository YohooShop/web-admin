webpackJsonp([3],{AzgL:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("IcnI"),i=a("4OJU"),o=a("E4LH"),r=a("Y6Jn"),l=a("vLgD");var n={props:{email:{type:String,required:!0}},data:function(){var e=this;return{loading:!1,dialog:!1,title:"修改邮箱",form:{pass:"",email:"",code:""},user:{email:"",password:""},codeLoading:!1,codeData:{type:"email",value:""},buttonName:"获取验证码",isDisabled:!1,time:60,rules:{pass:[{required:!0,message:"当前密码不能为空",trigger:"blur"}],email:[{required:!0,validator:function(t,a,s){""===a||null===a?s(new Error("新邮箱不能为空")):a===e.email?s(new Error("新邮箱不能与旧邮箱相同")):Object(o.c)(a)?s():s(new Error("邮箱格式错误"))},trigger:"blur"}],code:[{required:!0,message:"验证码不能为空",trigger:"blur"}]}}},methods:{cancel:function(){this.resetForm()},sendCode:function(){var e,t=this;if(this.form.email&&this.form.email!==this.email){this.codeLoading=!0,this.buttonName="验证码发送中",this.codeData.value=this.form.email;var a=this;(e=this.codeData,Object(l.a)({url:"/api/code/resetEmail",method:"post",data:e})).then(function(e){t.$message({showClose:!0,message:"发送成功，验证码有效期5分钟",type:"success"}),t.codeLoading=!1,t.isDisabled=!0,t.buttonName=t.time--+"秒后重新发送",t.timer=window.setInterval(function(){a.buttonName=a.time+"秒后重新发送",--a.time,a.time<0&&(a.buttonName="重新发送",a.time=60,a.isDisabled=!1,window.clearInterval(a.timer))},1e3)}).catch(function(e){t.resetForm(),t.codeLoading=!1})}},doSubmit:function(){var e=this;this.$refs.form.validate(function(t){if(!t)return!1;e.loading=!0;var a={email:e.form.email,code:e.form.code,password:e.form.pass};a.password!==Object(r.a)(Object(i.a)("password"))&&(a.password=Object(r.a)(a.password)),function(e){return Object(l.a)({url:"/admin/updateEmail",method:"post",data:e})}(a).then(function(t){e.loading=!1,e.resetForm(),e.$notify({title:"邮箱修改成功",type:"success",duration:1500}),s.a.dispatch("GetInfo").then(function(){})}).catch(function(t){e.loading=!1})})},resetForm:function(){this.dialog=!1,this.$refs.form.resetFields(),window.clearInterval(this.timer),this.time=60,this.buttonName="获取验证码",this.isDisabled=!1,this.form={pass:"",email:"",code:""}}}},c={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{display:"inline-block"}},[a("el-dialog",{attrs:{visible:e.dialog,"close-on-click-modal":!1,"before-close":e.cancel,title:e.title,"append-to-body":"",width:"475px"},on:{"update:visible":function(t){e.dialog=t},close:e.cancel}},[a("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,size:"small","label-width":"88px"}},[a("el-form-item",{attrs:{label:"新邮箱",prop:"email"}},[a("el-input",{staticStyle:{width:"200px"},attrs:{"auto-complete":"on"},model:{value:e.form.email,callback:function(t){e.$set(e.form,"email",t)},expression:"form.email"}}),e._v(" "),a("el-button",{attrs:{loading:e.codeLoading,disabled:e.isDisabled,size:"small"},on:{click:e.sendCode}},[e._v(e._s(e.buttonName))])],1),e._v(" "),a("el-form-item",{attrs:{label:"验证码",prop:"code"}},[a("el-input",{staticStyle:{width:"320px"},model:{value:e.form.code,callback:function(t){e.$set(e.form,"code",t)},expression:"form.code"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"当前密码",prop:"pass"}},[a("el-input",{staticStyle:{width:"320px"},attrs:{type:"password"},model:{value:e.form.pass,callback:function(t){e.$set(e.form,"pass",t)},expression:"form.pass"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"text"},on:{click:e.cancel}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{loading:e.loading,type:"primary"},on:{click:e.doSubmit}},[e._v("确认")])],1)],1)],1)},staticRenderFns:[]};var d=a("VU/8")(n,c,!1,function(e){a("PqZt")},"data-v-ea9f78ec",null);t.default=d.exports},PqZt:function(e,t){},Qguf:function(e,t){},cz2C:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("Dd8w"),i=a.n(s),o=a("NYxO"),r=a("jzet"),l=a("AzgL"),n=a("TIfe"),c=a("IcnI"),d=a("E4LH"),m=a("0xDb"),u=a("M9A7"),f={name:"Center",components:{updatePass:r.default,updateEmail:l.default},data:function(){return{activeName:"first",saveLoading:!1,headers:{Authorization:Object(n.a)()},form:{},rules:{nickname:[{required:!0,message:"请输入用户昵称",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"}],phone:[{required:!0,trigger:"blur",validator:function(e,t,a){t?Object(d.b)(t)?a():a(new Error("请输入正确的11位手机号码")):a(new Error("请输入电话号码"))}}]}}},computed:i()({},Object(o.b)(["name","nickName","email","phone","sex","updateAvatarApi","baseApi"])),created:function(){this.form={nickname:this.nickName,sex:this.sex,phone:this.phone},c.a.dispatch("GetInfo").then(function(){})},methods:{parseTime:m.f,handleClick:function(e,t){"second"===e.name&&this.init()},beforeInit:function(){return this.url="api/logs/user",!0},handleSuccess:function(e,t,a){this.$notify({title:"头像修改成功",type:"success",duration:2500}),c.a.dispatch("GetInfo").then(function(){})},handleError:function(e,t,a){var s=JSON.parse(e.message);this.$notify({title:s.message,type:"error",duration:2500})},doSubmit:function(){var e=this;this.$refs.form&&this.$refs.form.validate(function(t){if(t){e.saveLoading=!0;e.form;Object(u.e)(e.form).then(function(){e.editSuccessNotify(),c.a.dispatch("GetInfo").then(function(){}),e.saveLoading=!1}).catch(function(){e.saveLoading=!1})}})}}},p={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("el-row",{attrs:{gutter:20}},[a("el-col",{staticStyle:{"margin-bottom":"10px"},attrs:{xs:24,sm:24,md:8,lg:6,xl:5}},[a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("个人信息")])]),e._v(" "),a("div",[a("div",{staticStyle:{"text-align":"center"}}),e._v(" "),a("ul",{staticClass:"user-info"},[a("li",[a("div",{staticStyle:{height:"100%"}},[a("svg-icon",{attrs:{"icon-class":"login"}}),e._v(" 登录账号"),a("div",{staticClass:"user-right"},[e._v(e._s(e.name))])],1)]),e._v(" "),a("li",[a("svg-icon",{attrs:{"icon-class":"user1"}}),e._v(" 用户昵称 "),a("div",{staticClass:"user-right"},[e._v(e._s(e.nickName))])],1),e._v(" "),a("li",[a("svg-icon",{attrs:{"icon-class":"phone"}}),e._v(" 手机号码 "),a("div",{staticClass:"user-right"},[e._v(e._s(e.phone))])],1),e._v(" "),a("li",[a("svg-icon",{attrs:{"icon-class":"email"}}),e._v(" 用户邮箱 "),a("div",{staticClass:"user-right"},[e._v(e._s(e.email))])],1),e._v(" "),a("li",[a("svg-icon",{attrs:{"icon-class":"anq"}}),e._v(" 安全设置\n              "),a("div",{staticClass:"user-right"},[a("a",{on:{click:function(t){e.$refs.pass.dialog=!0}}},[e._v("修改密码")]),e._v(" "),a("a",{on:{click:function(t){e.$refs.email.dialog=!0}}},[e._v("修改邮箱")])])],1)])])])],1),e._v(" "),a("el-col",{attrs:{xs:24,sm:24,md:16,lg:18,xl:19}},[a("el-card",{staticClass:"box-card"},[a("el-tabs",{on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"用户资料",name:"first"}},[a("el-form",{ref:"form",staticStyle:{"margin-top":"10px"},attrs:{model:e.form,rules:e.rules,size:"small","label-width":"65px"}},[a("el-form-item",{attrs:{label:"昵称",prop:"nickName"}},[a("el-input",{staticStyle:{width:"35%"},model:{value:e.form.nickname,callback:function(t){e.$set(e.form,"nickname",t)},expression:"form.nickname"}}),e._v(" "),a("span",{staticStyle:{color:"#C0C0C0","margin-left":"10px"}},[e._v("用户昵称不作为登录使用")])],1),e._v(" "),a("el-form-item",{attrs:{label:"手机号",prop:"phone"}},[a("el-input",{staticStyle:{width:"35%"},model:{value:e.form.phone,callback:function(t){e.$set(e.form,"phone",t)},expression:"form.phone"}}),e._v(" "),a("span",{staticStyle:{color:"#C0C0C0","margin-left":"10px"}},[e._v("手机号码不能重复")])],1),e._v(" "),a("el-form-item",{attrs:{label:"性别"}},[a("el-radio-group",{staticStyle:{width:"178px"},model:{value:e.form.sex,callback:function(t){e.$set(e.form,"sex",t)},expression:"form.sex"}},[a("el-radio",{attrs:{label:"男"}},[e._v("男")]),e._v(" "),a("el-radio",{attrs:{label:"女"}},[e._v("女")])],1)],1),e._v(" "),a("el-form-item",{attrs:{label:""}},[a("el-button",{attrs:{loading:e.saveLoading,size:"mini",type:"primary"},on:{click:e.doSubmit}},[e._v("保存配置")])],1)],1)],1),e._v(" "),a("el-tab-pane",{attrs:{label:"操作日志",name:"second"}},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.data}},[a("el-table-column",{attrs:{prop:"description",label:"行为"}}),e._v(" "),a("el-table-column",{attrs:{prop:"requestIp",label:"IP"}}),e._v(" "),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,prop:"address",label:"IP来源"}}),e._v(" "),a("el-table-column",{attrs:{prop:"browser",label:"浏览器"}}),e._v(" "),a("el-table-column",{attrs:{prop:"time",label:"请求耗时",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.time<=300?a("el-tag",[e._v(e._s(t.row.time)+"ms")]):t.row.time<=1e3?a("el-tag",{attrs:{type:"warning"}},[e._v(e._s(t.row.time)+"ms")]):a("el-tag",{attrs:{type:"danger"}},[e._v(e._s(t.row.time)+"ms")])]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e.parseTime(t.row.createTime)))])]}}])},[a("template",{slot:"header"},[a("div",{staticStyle:{display:"inline-block",float:"right",cursor:"pointer"},on:{click:e.init}},[e._v("创建日期"),a("i",{staticClass:"el-icon-refresh",staticStyle:{"margin-left":"40px"}})])])],2)],1),e._v(" "),a("el-pagination",{staticStyle:{"margin-top":"8px"},attrs:{total:e.total,"current-page":e.page+1,layout:"total, prev, pager, next, sizes"},on:{"size-change":e.sizeChange,"current-change":e.pageChange}})],1)],1)],1)],1)],1),e._v(" "),a("updateEmail",{ref:"email",attrs:{email:e.email}}),e._v(" "),a("updatePass",{ref:"pass"})],1)},staticRenderFns:[]};var v=a("VU/8")(f,p,!1,function(e){a("Qguf")},null,null);t.default=v.exports},jzet:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("IcnI"),i=a("vLgD");var o=a("Y6Jn"),r={data:function(){var e=this;return{loading:!1,dialog:!1,title:"修改密码",form:{oldPass:"",newPass:"",confirmPass:""},rules:{oldPass:[{required:!0,message:"请输入旧密码",trigger:"blur"}],newPass:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,max:20,message:"长度在 6 到 20 个字符",trigger:"blur"}],confirmPass:[{required:!0,validator:function(t,a,s){a?e.form.newPass!==a?s(new Error("两次输入的密码不一致")):s():s(new Error("请再次输入密码"))},trigger:"blur"}]}}},methods:{cancel:function(){this.resetForm()},doSubmit:function(){var e=this;this.$refs.form.validate(function(t){if(!t)return!1;e.loading=!0,function(e){return Object(i.a)({url:"/admin/updateMinePassword",method:"post",data:e})}({oldPassword:Object(o.a)(e.form.oldPass),newPassword:Object(o.a)(e.form.newPass)}).then(function(t){e.resetForm(),e.$notify({title:"密码修改成功，请重新登录",type:"success",duration:1500}),setTimeout(function(){s.a.dispatch("LogOut").then(function(){location.reload()})},1500)}).catch(function(t){e.loading=!1,console.log(t.response.data.message)})})},resetForm:function(){this.dialog=!1,this.$refs.form.resetFields(),this.form={oldPass:"",newPass:"",confirmPass:""}}}},l={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{display:"inline-block"}},[a("el-dialog",{attrs:{visible:e.dialog,"close-on-click-modal":!1,"before-close":e.cancel,title:e.title,"append-to-body":"",width:"500px"},on:{"update:visible":function(t){e.dialog=t},close:e.cancel}},[a("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,size:"small","label-width":"88px"}},[a("el-form-item",{attrs:{label:"旧密码",prop:"oldPass"}},[a("el-input",{staticStyle:{width:"370px"},attrs:{type:"password","auto-complete":"on"},model:{value:e.form.oldPass,callback:function(t){e.$set(e.form,"oldPass",t)},expression:"form.oldPass"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"新密码",prop:"newPass"}},[a("el-input",{staticStyle:{width:"370px"},attrs:{type:"password","auto-complete":"on"},model:{value:e.form.newPass,callback:function(t){e.$set(e.form,"newPass",t)},expression:"form.newPass"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"确认密码",prop:"confirmPass"}},[a("el-input",{staticStyle:{width:"370px"},attrs:{type:"password","auto-complete":"on"},model:{value:e.form.confirmPass,callback:function(t){e.$set(e.form,"confirmPass",t)},expression:"form.confirmPass"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"text"},on:{click:e.cancel}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{loading:e.loading,type:"primary"},on:{click:e.doSubmit}},[e._v("确认")])],1)],1)],1)},staticRenderFns:[]};var n=a("VU/8")(r,l,!1,function(e){a("k4Bz")},"data-v-fca38bea",null);t.default=n.exports},k4Bz:function(e,t){}});
//# sourceMappingURL=3.ceee2f8b6f8992182d55.js.map